(()=>{"use strict";var e={baseURL:"https://nomoreparties.co/v1/wff-cohort-20",headers:{authorization:"0d91823f-13f9-4f12-9bf1-32d1686a125a","Content-Type":"application/json"}},t=function(){return fetch("".concat(e.baseURL,"/users/me"),{method:"GET",headers:e.headers}).then((function(e){if(e.ok)return e.json();Promise.reject("Произошла ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))},n=function(){return fetch("".concat(e.baseURL,"/cards"),{method:"GET",headers:e.headers}).then((function(e){if(e.ok)return e.json();Promise.reject("Произошла ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))};function o(e,t,n,o,r){var c=e.name,a=e.link,i=e.likes,u=e.owner._id,s=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),l=s.querySelector(".card__title"),d=s.querySelector(".card__image"),p=s.querySelector(".card__like-button"),f=s.querySelector(".card__delete-button"),_=s.querySelector(".card__like-counter");return i.find((function(e){return e._id==t}))&&p.classList.add("card__like-button_is-active"),t==u?f.addEventListener("click",n):f.remove(),d.setAttribute("src",a),d.setAttribute("alt",c),l.textContent=c,d.addEventListener("click",o),p.addEventListener("click",r),_.textContent=i.length,s}function r(t){var o=Array.from(document.querySelectorAll(".card")),r=o.indexOf(t.target.closest(".card")),c=t.target;n().then((function(e){return o.length==e.length?e[r]._id:Promise.reject("Данные сервера и сайта отличаются, пожалуйста, перезагрузите страницу.")})).then((function(t){c.classList.contains("card__like-button_is-active")?function(t){return fetch("".concat(e.baseURL,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(t).then((function(e){c.closest(".card__like").querySelector(".card__like-counter").textContent=e.likes.length,c.classList.remove("card__like-button_is-active")})):function(t){return fetch("".concat(e.baseURL,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(t).then((function(e){c.closest(".card__like").querySelector(".card__like-counter").textContent=e.likes.length,c.classList.add("card__like-button_is-active")}))})).catch((function(e){console.log(e)}))}function c(e){e.querySelector(".popup__close").addEventListener("click",i),e.addEventListener("mousedown",u),document.addEventListener("keydown",s),e.classList.toggle("popup_is-opened")}function a(e){e.querySelector(".popup__close").removeEventListener("click",i),e.removeEventListener("mousedown",u),document.removeEventListener("keydown",s),e.classList.toggle("popup_is-opened")}function i(e){a(e.target.closest(".popup"))}function u(e){e.target.classList.contains("popup")&&a(e.target)}function s(e){"Escape"===e.key&&a(document.querySelector(".popup_is-opened"))}function l(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n)):(t.disabled=!0,t.classList.add(n))}function d(e){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])){var t=Array.from(e.querySelectorAll(".popup__input")),n=Array.from(e.querySelectorAll(".popup__error"));t.forEach((function(e){e.classList.remove("popup__input_type_error"),e.value=""})),n.forEach((function(e){e.classList.remove("popup__error_visible"),e.textContent=""}));var o=e.querySelector(".popup__button");o.disabled=!0,o.classList.add("popup__button_disabled")}}function p(e,t,n,o,r){e.classList.add(t),r.classList.add(n),r.textContent=o}var f,_,m,h,v,y,b,g=n(),S=t(),L=document.querySelector(".places__list"),k=document.querySelector(".profile__add-button"),q=document.querySelector(".profile__edit-button"),E=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),A=document.querySelector(".popup_type_image"),j=A.querySelector(".popup__image"),P=A.querySelector(".popup__caption"),U=document.querySelector(".popup_type_edit"),R=document.forms["edit-profile"],T=document.querySelector(".popup_type_new-card"),w=document.forms["new-place"],D=document.querySelector(".popup_type_card-delete"),O=document.forms["delete-card"],B=document.querySelector(".popup_type_change-profile-photo"),N=document.forms["change-profile-photo"];function J(t){c(D),O.addEventListener("submit",(function(o){o.preventDefault(),function(t,o){var r=Array.from(document.querySelectorAll(".card")),c=r.indexOf(t.target.closest(".card"));n().then((function(e){return r.length==e.length?e[c]._id:Promise.reject("Данные сервера и сайта отличаются, пожалуйста, перезагрузите страницу.")})).then((function(t){return function(t){return fetch("".concat(e.baseURL,"/cards/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e:Promise.reject("Произошла ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(t)})).then((function(e){e.ok&&(function(e){e.remove()}(o),a(D),d(D))}))}(t,t.target.closest(".card"))}))}function M(e){if(e.target.classList.contains("card__image")){var t=e.target.closest(".card"),n=t.querySelector(".card__title").textContent,o=t.querySelector(".card__image").getAttribute("src");j.setAttribute("src",o),j.setAttribute("alt",n),P.textContent=n,c(A)}}function G(t){var n;t.preventDefault(),H(N,!0),(n=N.link.value,fetch("".concat(e.baseURL,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){console.log(e),x.style.backgroundImage="url(".concat(e.avatar,")"),a(B),d(B)})).finally((function(){H(N,!1)}))}function H(e,t){var n=e.querySelector(".popup__button");t?(n.textContent="Сохранение...",n.disabled=!0):(n.textContent="Сохранить",n.disabled=!1)}R.name.value=E.textContent,R.description.value=C.textContent,_=(f={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}).formSelector,m=f.inputSelector,h=f.submitButtonSelector,v=f.inactiveButtonClass,y=f.inputErrorClass,b=f.errorClass,Array.from(document.querySelectorAll(_)).forEach((function(e){var t=Array.from(e.querySelectorAll(m));l(t,e.querySelector(h),v),t.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.validity.patternMismatch?p(t,n,o,t.dataset.errorMsg,r):t.validity.valid?function(e,t,n,o){e.classList.remove(t),o.classList.remove(n),o.textContent=""}(t,n,o,r):p(t,n,o,t.validationMessage,r)}(e,n,y,b),l(t,e.querySelector(h),v)}))}))})),Promise.all([g,S]).then((function(e){var t=e[1],n=t.name,c=t.about,a=t.avatar,i=t._id;E.textContent=n,C.textContent=c,x.style.backgroundImage="url('".concat(a,"')"),e[0].forEach((function(e){var t=o(e,i,J,M,r);L.append(t)}))})),x.addEventListener("click",(function(){N.addEventListener("submit",G),c(B)})),q.addEventListener("click",(function(){R.name.value=E.textContent,R.description.value=C.textContent,c(U)})),k.addEventListener("click",(function(){c(T)})),w.addEventListener("submit",(function(n){var c,i;n.preventDefault(),H(w,!0),(c=w["place-name"].value,i=w.link.value,fetch("".concat(e.baseURL,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:c,link:i})}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){t().then((function(e){return e._id})).then((function(t){var n=o(e,t,J,M,r);L.prepend(n),a(T),d(T)}))})).finally((function(){H(w,!1)}))})),R.addEventListener("submit",(function(t){var n,o;t.preventDefault(),H(R,!0),(n=R.name.value,o=R.description.value,fetch("".concat(e.baseURL,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){E.textContent=e.name,C.textContent=e.about,a(U),d(U)})).finally((function(){H(U,!1)}))}))})();