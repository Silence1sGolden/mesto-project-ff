(()=>{"use strict";var e={baseURL:"https://nomoreparties.co/v1/wff-cohort-20",headers:{authorization:"0d91823f-13f9-4f12-9bf1-32d1686a125a","Content-Type":"application/json"}},t=function(e){return e.ok?e.json():Promise.reject("Произошла ошибка: ".concat(e.status))},n=function(t){return fetch("".concat(e.baseURL,"/cards/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e:Promise.reject("Произошла ошибка: ".concat(e.status))}))};function o(e,t,n,o,r){var c=e.name,a=e.link,i=e.likes,u=e._id,s=e.owner._id,l=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),d=l.querySelector(".card__title"),p=l.querySelector(".card__image"),f=l.querySelector(".card__like-button"),_=l.querySelector(".card__delete-button"),m=l.querySelector(".card__like-counter");return i.find((function(e){return e._id==t}))&&f.classList.add("card__like-button_is-active"),t==s?_.addEventListener("click",(function(t){n(t,e)})):_.remove(),p.setAttribute("src",a),p.setAttribute("alt",c),d.textContent=c,p.addEventListener("click",o),f.addEventListener("click",(function(){r(f,u)})),m.textContent=i.length,l}function r(n,o){n.classList.contains("card__like-button_is-active")?function(n){return fetch("".concat(e.baseURL,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return t(e)}))}(o).then((function(e){n.closest(".card__like").querySelector(".card__like-counter").textContent=e.likes.length,n.classList.remove("card__like-button_is-active")})).catch((function(e){console.log(e)})):function(n){return fetch("".concat(e.baseURL,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then((function(e){return t(e)}))}(o).then((function(e){n.closest(".card__like").querySelector(".card__like-counter").textContent=e.likes.length,n.classList.add("card__like-button_is-active")})).catch((function(e){console.log(e)}))}function c(e){e.querySelector(".popup__close").addEventListener("click",i),e.addEventListener("mousedown",u),document.addEventListener("keydown",s),e.classList.toggle("popup_is-opened")}function a(e){e.querySelector(".popup__close").removeEventListener("click",i),e.removeEventListener("mousedown",u),document.removeEventListener("keydown",s),e.classList.toggle("popup_is-opened")}function i(e){a(e.target.closest(".popup"))}function u(e){e.target.classList.contains("popup")&&a(e.target)}function s(e){"Escape"===e.key&&a(document.querySelector(".popup_is-opened"))}function l(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n)):(t.disabled=!0,t.classList.add(n))}function d(e,t){var n=t.inputSelector,o=t.submitButtonSelector,r=t.inactiveButtonClass,c=t.inputErrorClass,a=t.errorClass,i=t.errorSelector,u=Array.from(e.querySelectorAll(n)),s=Array.from(e.querySelectorAll(i)),l=e.querySelector(o);u.forEach((function(e){e.classList.remove(c),e.value=""})),s.forEach((function(e){e.classList.remove(a),e.textContent=""})),l.disabled=!0,l.classList.add(r)}function p(e,t,n,o,r){e.classList.add(t),r.classList.add(n),r.textContent=o}var f,_,m,v,h,y,b,S={errorSelector:".popup__error",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},L=fetch("".concat(e.baseURL,"/cards"),{method:"GET",headers:e.headers}).then((function(e){return t(e)})),q=fetch("".concat(e.baseURL,"/users/me"),{method:"GET",headers:e.headers}).then((function(e){return t(e)})),E=document.querySelector(".places__list"),k=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__edit-button"),C=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),A=document.querySelector(".profile__image"),U=document.querySelector(".popup_type_image"),R=U.querySelector(".popup__image"),w=U.querySelector(".popup__caption"),T=document.querySelector(".popup_type_edit"),B=document.forms["edit-profile"],P=document.querySelector(".popup_type_new-card"),D=document.forms["new-place"],j=document.querySelector(".popup_type_card-delete"),N=document.forms["delete-card"],O=document.querySelector(".popup_type_change-profile-photo"),J=document.forms["change-profile-photo"];function M(e,t){c(j),N.querySelector(".popup__button").onclick=function(n){n.preventDefault(),I(t,e.target.closest(".card"))}}function G(e){if(e.target.classList.contains("card__image")){var t=e.target.closest(".card"),n=t.querySelector(".card__title").textContent,o=t.querySelector(".card__image").getAttribute("src");R.setAttribute("src",o),R.setAttribute("alt",n),w.textContent=n,c(U)}}function H(n){var o;n.preventDefault(),z(J,!0),(o=J.link.value,fetch("".concat(e.baseURL,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then((function(e){return t(e)}))).then((function(e){A.style.backgroundImage="URL(".concat(e.avatar,")"),a(O),d(O,S)})).catch((function(e){F(e)})).finally((function(){z(J,!1)}))}function I(e,t){n(e._id).then((function(){!function(e){e.remove()}(t),a(j)})).catch((function(e){F(e)}))}function z(e,t){var n=e.querySelector(".popup__button");t?(n.textContent="Сохранение...",n.disabled=!0):(n.textContent="Сохранить",n.disabled=!1)}function F(e){console.log(e)}_=(f={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}).formSelector,m=f.inputSelector,v=f.submitButtonSelector,h=f.inactiveButtonClass,y=f.inputErrorClass,b=f.errorClass,Array.from(document.querySelectorAll(_)).forEach((function(e){var t=Array.from(e.querySelectorAll(m));l(t,e.querySelector(v),h),t.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.validity.patternMismatch?p(t,n,o,t.dataset.errorMsg,r):t.validity.valid?function(e,t,n,o){e.classList.remove(t),o.classList.remove(n),o.textContent=""}(t,n,o,r):p(t,n,o,t.validationMessage,r)}(e,n,y,b),l(t,e.querySelector(v),h)}))}))})),Promise.all([L,q]).then((function(e){var t=e[1],n=t.name,c=t.about,a=t.avatar,i=t._id;C.textContent=n,x.textContent=c,A.style.backgroundImage="url('".concat(a,"')"),e[0].forEach((function(e){var t=o(e,i,M,G,r);E.append(t)}))})).catch((function(e){F(e)})),J.addEventListener("submit",H),A.addEventListener("click",(function(){c(O)})),J.addEventListener("submit",H),g.addEventListener("click",(function(){B.name.value=C.textContent,B.description.value=x.textContent,c(T)})),k.addEventListener("click",(function(){c(P)})),D.addEventListener("submit",(function(n){var c,i;n.preventDefault(),z(D,!0),(c=D["place-name"].value,i=D.link.value,fetch("".concat(e.baseURL,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:c,link:i})}).then((function(e){return t(e)}))).then((function(e){var t=o(e,e.owner._id,M,G,r);E.prepend(t),a(P),d(P,S)})).catch((function(e){F(e)})).finally((function(){z(D,!1)}))})),B.addEventListener("submit",(function(n){var o,r;n.preventDefault(),z(B,!0),(o=B.name.value,r=B.description.value,fetch("".concat(e.baseURL,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o,about:r})}).then((function(e){return t(e)}))).then((function(e){C.textContent=e.name,x.textContent=e.about,a(T),d(T,S)})).catch((function(e){F(e)})).finally((function(){z(T,!1)}))})),N.addEventListener("submit",I)})();