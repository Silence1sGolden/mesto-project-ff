(()=>{"use strict";var e={baseURL:"https://nomoreparties.co/v1/wff-cohort-20",headers:{authorization:"0d91823f-13f9-4f12-9bf1-32d1686a125a","Content-Type":"application/json"}};function t(e){console.log(e)}function n(e,t,n,o,r){var c=e.name,a=e.link,i=e.likes,u=e.owner._id,s=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),l=s.querySelector(".card__title"),d=s.querySelector(".card__image"),p=s.querySelector(".card__like-button"),f=s.querySelector(".card__delete-button"),_=s.querySelector(".card__like-counter");return i.find((function(e){return e._id==t}))&&p.classList.add("card__like-button_is-active"),t==u?f.addEventListener("click",n):f.remove(),d.setAttribute("src",a),d.setAttribute("alt",c),l.textContent=c,d.addEventListener("click",o),p.addEventListener("click",(function(){r(p,e._id)})),_.textContent=i.length,s}function o(n,o){n.classList.contains("card__like-button_is-active")?function(n){return fetch("".concat(e.baseURL,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка: ".concat(e.status))})).catch((function(e){t(e)}))}(o).then((function(e){n.closest(".card__like").querySelector(".card__like-counter").textContent=e.likes.length,n.classList.remove("card__like-button_is-active")})).catch((function(e){console.log(e)})):function(n){return fetch("".concat(e.baseURL,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка: ".concat(e.status))})).catch((function(e){t(e)}))}(o).then((function(e){n.closest(".card__like").querySelector(".card__like-counter").textContent=e.likes.length,n.classList.add("card__like-button_is-active")})).catch((function(e){console.log(e)}))}function r(e){e.querySelector(".popup__close").addEventListener("click",a),e.addEventListener("mousedown",i),document.addEventListener("keydown",u),e.classList.toggle("popup_is-opened")}function c(e){e.querySelector(".popup__close").removeEventListener("click",a),e.removeEventListener("mousedown",i),document.removeEventListener("keydown",u),e.classList.toggle("popup_is-opened")}function a(e){c(e.target.closest(".popup"))}function i(e){e.target.classList.contains("popup")&&c(e.target)}function u(e){"Escape"===e.key&&c(document.querySelector(".popup_is-opened"))}function s(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n)):(t.disabled=!0,t.classList.add(n))}function l(e,t){var n=t.inputSelector,o=t.submitButtonSelector,r=t.inactiveButtonClass,c=t.inputErrorClass,a=t.errorClass,i=t.errorSelector,u=Array.from(e.querySelectorAll(n)),s=Array.from(e.querySelectorAll(i)),l=e.querySelector(o);u.forEach((function(e){e.classList.remove(c),e.value=""})),s.forEach((function(e){e.classList.remove(a),e.textContent=""})),l.disabled=!0,l.classList.add(r)}function d(e,t,n,o,r){e.classList.add(t),r.classList.add(n),r.textContent=o}var p,f,_,m,h,v,y,b={errorSelector:".popup__error",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},S=fetch("".concat(e.baseURL,"/cards"),{method:"GET",headers:e.headers}).then((function(e){if(e.ok)return e.json();Promise.reject("Произошла ошибка: ".concat(e.status))})).catch((function(e){t(e)})),L=fetch("".concat(e.baseURL,"/users/me"),{method:"GET",headers:e.headers}).then((function(e){if(e.ok)return e.json();Promise.reject("Произошла ошибка: ".concat(e.status))})).catch((function(e){t(e)})),k=document.querySelector(".places__list"),g=document.querySelector(".profile__add-button"),q=document.querySelector(".profile__edit-button"),E=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),j=document.querySelector(".popup_type_image"),A=j.querySelector(".popup__image"),T=j.querySelector(".popup__caption"),P=document.querySelector(".popup_type_edit"),D=document.forms["edit-profile"],U=document.querySelector(".popup_type_new-card"),R=document.forms["new-place"],w=document.querySelector(".popup_type_card-delete"),B=document.forms["delete-card"],O=document.querySelector(".popup_type_change-profile-photo"),N=document.forms["change-profile-photo"],J={cardToDelete:""};function M(e){var t=e.target.closest(".card"),n=Array.from(document.querySelectorAll(".card")).indexOf(t);J.cardToDelete=J.cards[n],r(w)}function G(e){if(e.target.classList.contains("card__image")){var t=e.target.closest(".card"),n=t.querySelector(".card__title").textContent,o=t.querySelector(".card__image").getAttribute("src");A.setAttribute("src",o),A.setAttribute("alt",n),T.textContent=n,r(j)}}function H(e,t){var n=e.querySelector(".popup__button");t?(n.textContent="Сохранение...",n.disabled=!0):(n.textContent="Сохранить",n.disabled=!1)}function I(e){console.log(e)}D.name.value=E.textContent,D.description.value=C.textContent,f=(p={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}).formSelector,_=p.inputSelector,m=p.submitButtonSelector,h=p.inactiveButtonClass,v=p.inputErrorClass,y=p.errorClass,Array.from(document.querySelectorAll(f)).forEach((function(e){var t=Array.from(e.querySelectorAll(_));s(t,e.querySelector(m),h),t.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.validity.patternMismatch?d(t,n,o,t.dataset.errorMsg,r):t.validity.valid?function(e,t,n,o){e.classList.remove(t),o.classList.remove(n),o.textContent=""}(t,n,o,r):d(t,n,o,t.validationMessage,r)}(e,n,v,y),s(t,e.querySelector(m),h)}))}))})),Promise.all([S,L]).then((function(e){J.user=e[1],J.cards=e[0];var t=e[1],r=t.name,c=t.about,a=t.avatar,i=t._id;E.textContent=r,C.textContent=c,x.style.backgroundImage="url('".concat(a,"')"),e[0].forEach((function(e){var t=n(e,i,M,G,o);k.append(t)})).catch((function(e){I(e)}))})),x.addEventListener("click",(function(){r(O)})),N.addEventListener("submit",(function(n){n.preventDefault(),H(N,!0),function(n){return fetch("".concat(e.baseURL,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка: ".concat(e.status))})).catch((function(e){t(e)}))}(N.link.value).then((function(e){console.log(e),x.style.backgroundImage="url(".concat(e.avatar,")"),c(O),l(O,b)})).catch((function(e){I(e)})).finally((function(){H(N,!1)}))})),q.addEventListener("click",(function(){D.name.value=E.textContent,D.description.value=C.textContent,r(P)})),g.addEventListener("click",(function(){r(U)})),R.addEventListener("submit",(function(r){var a,i;r.preventDefault(),H(R,!0),(a=R["place-name"].value,i=R.link.value,fetch("".concat(e.baseURL,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:a,link:i})}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка: ".concat(e.status))})).catch((function(e){t(e)}))).then((function(e){console.log(L);var t=n(e,J.user._id,M,G,o);J.cards.unshift(e),k.prepend(t),c(U),l(U,b)})).catch((function(e){I(e)})).finally((function(){H(R,!1)}))})),D.addEventListener("submit",(function(n){var o,r;n.preventDefault(),H(D,!0),(o=D.name.value,r=D.description.value,fetch("".concat(e.baseURL,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка: ".concat(e.status))})).catch((function(e){t(e)}))).then((function(e){E.textContent=e.name,C.textContent=e.about,c(P),l(P,b)})).catch((function(e){I(e)})).finally((function(){H(P,!1)}))})),B.addEventListener("submit",(function(n){var o;n.preventDefault(),(o=J.cardToDelete._id,fetch("".concat(e.baseURL,"/cards/").concat(o),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка: ".concat(e.status))})).catch((function(e){t(e)}))).then((function(){var e=J.cards.indexOf(J.cardToDelete);J.cards.splice(e,1),k.children[e].remove(),J.cardToDelete="",c(w)})).catch((function(e){I(e)}))}))})();